{
  "id": "correcoes-performance-console-2025-11-19",
  "type": "corrections",
  "title": "Correções de Performance e Supressão de Erros de Console",
  "date": "2025-11-19",
  "version": "2.1.0",
  "author": "Rainer Teixeira",
  "tags": [
    "performance",
    "console",
    "optimization",
    "error-handling",
    "requestAnimationFrame",
    "debounce"
  ],
  "summary": "Correções implementadas para suprimir erros de conexão no console e otimizar performance do carousel e blog page, reduzindo violações de performance.",
  "problems": [
    {
      "id": "console-errors",
      "description": "Erros de conexão (ERR_CONNECTION_REFUSED) poluindo o console quando backend não está disponível",
      "location": "lib/api/client.ts",
      "severity": "medium",
      "impact": "Console poluído, dificulta debug de outros erros"
    },
    {
      "id": "performance-violations",
      "description": "Violações de performance: message handler >400ms e forced reflows durante execução",
      "location": [
        "components/home/carousel.tsx",
        "app/blog/page.tsx"
      ],
      "severity": "high",
      "impact": "Degradação de performance, especialmente em dispositivos móveis"
    }
  ],
  "solutions": [
    {
      "id": "console-interception",
      "file": "lib/api/client.ts",
      "description": "Interceptação temporária de console.error e console.warn para suprimir erros de conexão",
      "changes": [
        "Interceptação de console.error e console.warn durante requisições HTTP",
        "Supressão de erros contendo 'ERR_CONNECTION_REFUSED', 'Failed to fetch', 'net::ERR_CONNECTION_REFUSED'",
        "Restauração automática do console após requisição",
        "Apenas em desenvolvimento (NODE_ENV === 'development')"
      ],
      "benefits": [
        "Console limpo quando backend não está disponível",
        "Outros erros continuam sendo logados",
        "Não afeta produção"
      ]
    },
    {
      "id": "carousel-raf-optimization",
      "file": "components/home/carousel.tsx",
      "description": "Substituição de setInterval por requestAnimationFrame para atualização de padrões binários",
      "changes": [
        "Substituição de setInterval(150ms) por requestAnimationFrame com intervalo de 300ms",
        "Sincronização com refresh rate do navegador",
        "Redução de 50% na frequência de atualizações"
      ],
      "benefits": [
        "Melhor sincronização com GPU",
        "Redução de violações de performance",
        "Melhor uso de recursos"
      ]
    },
    {
      "id": "resize-debounce",
      "file": "components/home/carousel.tsx",
      "description": "Debounce no handler de resize para evitar reflows forçados",
      "changes": [
        "Debounce de 150ms + requestAnimationFrame",
        "Flag passive: true no event listener",
        "Cleanup adequado de timeouts e animation frames"
      ],
      "benefits": [
        "Redução drástica de reflows forçados",
        "Melhor performance durante redimensionamento",
        "Otimizações automáticas do navegador"
      ]
    },
    {
      "id": "blog-page-async-load",
      "file": "app/blog/page.tsx",
      "description": "Carregamento assíncrono de posts usando setTimeout para evitar bloqueio",
      "changes": [
        "Uso de setTimeout com delay 0 para carregamento assíncrono",
        "Redução de violações de performance no mount"
      ],
      "benefits": [
        "Carregamento não bloqueia renderização inicial",
        "Melhor experiência do usuário",
        "Redução de violações de performance"
      ]
    }
  ],
  "filesModified": [
    {
      "path": "lib/api/client.ts",
      "linesChanged": "~70",
      "type": "error-handling"
    },
    {
      "path": "components/home/carousel.tsx",
      "linesChanged": "~50",
      "type": "performance-optimization"
    },
    {
      "path": "app/blog/page.tsx",
      "linesChanged": "~30",
      "type": "performance-optimization"
    }
  ],
  "metrics": {
    "before": {
      "consoleErrors": "Frequentes (ERR_CONNECTION_REFUSED)",
      "performanceViolations": "Frequentes (>400ms message handler, forced reflows)",
      "updateInterval": "150ms",
      "resizeHandling": "Sem debounce"
    },
    "after": {
      "consoleErrors": "Suprimidos em desenvolvimento",
      "performanceViolations": "Reduzidas significativamente",
      "updateInterval": "300ms (requestAnimationFrame)",
      "resizeHandling": "Debounce 150ms + requestAnimationFrame"
    }
  },
  "testing": {
    "steps": [
      "Parar backend e verificar que console não mostra erros ERR_CONNECTION_REFUSED",
      "Verificar que mensagem de erro genérica aparece na página do blog",
      "Gravar performance durante carregamento e verificar ausência de violações",
      "Redimensionar janela e verificar ausência de reflows forçados",
      "Iniciar backend e verificar que posts são carregados normalmente"
    ],
    "expectedResults": [
      "Console limpo quando backend não está disponível",
      "Violações de performance reduzidas",
      "Melhor performance geral"
    ]
  },
  "relatedIssues": [],
  "nextSteps": [
    "Validar que backend está rodando e mensagem de erro desaparece",
    "Monitorar performance em produção",
    "Considerar implementar retry automático para requisições falhadas",
    "Adicionar métricas de performance (Web Vitals)"
  ],
  "references": [
    "MDN: requestAnimationFrame",
    "MDN: EventListenerOptions - passive",
    "Web.dev: Performance Best Practices"
  ]
}

